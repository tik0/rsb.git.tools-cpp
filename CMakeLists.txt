CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

PROJECT("RSBTimeSync")

# --- project settings ---

OPTION(OPTION_BUILD_EXAMPLES "Whether to build the examples or not" TRUE)
OPTION(OPTION_BUILD_TESTS "Whether to build the tests or not" TRUE)

SET(LIBRARY_NAME "rsbts")
SET(BINARY_NAME "rsb_timesync")

# --- dependencies ---

FIND_PACKAGE(RSC REQUIRED)
SET(CMAKE_MODULE_PATH ${RSC_CMAKE_MODULE_PATH} ${CMAKE_MODULE_PATH})
FIND_PACKAGE(RSB REQUIRED)
FIND_PACKAGE(Boost COMPONENTS program_options)
FIND_PACKAGE(ProtocolBuffers REQUIRED)
IF(NOT PROTOBUF_PROTOC_EXECUTABLE)
    MESSAGE(FATAL_ERROR "protoc executable not found")
ENDIF()
IF(NOT PROTOBUF_FOUND)
    MESSAGE(FATAL_ERROR "protocol buffers not found")
ENDIF()
FIND_PACKAGE(Spread)

INCLUDE_DIRECTORIES(BEFORE SYSTEM ${RSB_INCLUDE_DIRS}
                                  ${RST_INCLUDE_DIRS}
                                  ${BOOST_INCLUDE_DIRS})

ADD_DEFINITIONS(${RSB_PROTOCOL_CFLAGS})

SET(CMAKE_MODULE_PATH ${CMAKE_MODUKE_PATH} ${RSC_CMAKE_MODULE_PATH})

ADD_SUBDIRECTORY(src)
IF(OPTION_BUILD_TESTS)
    INCLUDE(ProvideGoogleMock)
    IF(GMOCK_AVAILABLE)
        ADD_SUBDIRECTORY(test)
    ELSE()
        MESSAGE(WARNING "Could not build unit tests even though desired because Google Mock could not be installed.")
    ENDIF()
ENDIF()
ENABLE_TESTING()
IF(OPTION_BUILD_EXAMPLES) # AND SPREAD_EXECUTABLE)
    ADD_SUBDIRECTORY(examples)
ENDIF()

# --- package ---

SET(CPACK_PACKAGE_VENDOR "CoR-Lab Bielefeld University")
SET(CPACK_PACKAGE_VERSION_MAJOR 0)
SET(CPACK_PACKAGE_VERSION_MINOR 1)
SET(CPACK_PACKAGE_VERSION_PATCH 0)
SET(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_CURRENT_SOURCE_DIR}/COPYING.txt")

INCLUDE(CPack)
